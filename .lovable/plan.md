

# بطاقات القدرات الديناميكية في صفحة Brain

## الفكرة

بدلا من 3 بطاقات ثابتة دائما (مستشار استراتيجي، تخطيط أعمال، تدريب أعمال)، تصبح البطاقات **ديناميكية ومخصصة** — يختار Brain تلقائيا أنسب 3 بطاقات للمستخدم بناء على:

1. **بيانات OIL** — مؤشرات الصحة المؤسسية (ExecutionHealth, DeliveryRisk, GoalProgress)
2. **حالة Workboard** — مهام متأخرة، مهام محظورة، عدد الأهداف
3. **حالة الإعداد** — هل أكمل المستخدم إعداد الأعمال؟
4. **الوقت** — صباحا يركز على التخطيط، مساء على المراجعة

## كيف تعمل

يوجد pool (مجموعة) من 6-8 بطاقات ممكنة. Hook جديد اسمه `useSmartCapabilities` يختار أفضل 3 بناء على أولوية ذكية:

### مجموعة البطاقات المتاحة

| البطاقة | متى تظهر؟ | الأولوية |
|---------|-----------|----------|
| **إعداد الأعمال** | لم يكتمل الإعداد بعد | عالية جدا |
| **تحليل المخاطر** | مؤشر DeliveryRisk < 40 (يحتاج انتباه) | عالية |
| **إعادة ترتيب الأولويات** | مهام متأخرة > 3 | عالية |
| **فك المهام المحظورة** | مهام blocked > 0 | عالية |
| **تحديد الأهداف** | لا توجد أهداف محددة | متوسطة |
| **المستشار الاستراتيجي** | افتراضي — تحليل شامل | عادية |
| **تخطيط الأعمال** | افتراضي — بناء خطط | عادية |
| **تدريب الأعمال** | افتراضي — نصائح أداء | عادية |

النظام يرتب حسب الأولوية ويعرض أعلى 3 فقط. إذا لم تكن هناك مشاكل عاجلة، تظهر البطاقات الثلاث الأساسية (المستشار، التخطيط، التدريب).

## أمثلة عملية

**مستخدم جديد لم يكمل الإعداد:**
- اعداد الأعمال | تحديد الأهداف | تخطيط الأعمال

**مستخدم عنده مهام متأخرة ومخاطر عالية:**
- تحليل المخاطر | إعادة ترتيب الأولويات | تدريب الأعمال

**مستخدم كل شيء عنده جيد:**
- المستشار الاستراتيجي | تخطيط الأعمال | تدريب الأعمال

## التفاصيل التقنية

### 1. Hook جديد: useSmartCapabilities

- يدمج بيانات `useOILIndicators` + `useWorkspace` + عدد المهام (نفس منطق `useSmartSuggestions` الموجود)
- يرتب البطاقات حسب الأولوية ويعيد أعلى 3
- كل بطاقة تحتوي: `icon`, `titleKey`, `descKey`, `action` (للضغط)

### 2. تعديل EmptyState في BrainPage.tsx

- استبدال المصفوفة الثابتة بنتيجة `useSmartCapabilities()`
- كل بطاقة عند الضغط عليها ترسل prompt مخصص للـ Brain مع action
- إضافة hover effect وسهم للدلالة على أنها تفاعلية

### 3. تعديل brain-chat Edge Function

- إضافة 5 actions جديدة: `strategic_analysis`, `business_planning`, `business_coaching`, `risk_analysis`, `reprioritize`
- كل action يضيف تعليمات مخصصة في system prompt

### 4. تحديث ملفات الترجمة (5 لغات)

- إضافة عناوين ووصف للبطاقات الجديدة (إعداد الأعمال، تحليل المخاطر، إعادة الترتيب، فك المحظورة)
- إضافة prompts لكل action

### الملفات المتأثرة

1. `src/pages/brain/BrainPage.tsx` — EmptyState + hook جديد
2. `supabase/functions/brain-chat/index.ts` — actions جديدة
3. `src/i18n/translations/en.json`
4. `src/i18n/translations/ar.json`
5. `src/i18n/translations/fr.json`
6. `src/i18n/translations/es.json`
7. `src/i18n/translations/de.json`

